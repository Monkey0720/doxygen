<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<title>EIC Software: fun4all_acts/blob/master/Core/include/Acts/Propagator/DenseEnvironmentExtension.hpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script> <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script> 
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155388685-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-155388685-3');
</script>
</head>
<body>
	<div id="top">
		<!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectlogo"><a href="https://eic.github.io/"><img
								alt="Logo" src="../../ion-collision-xparent-crop.png" height="100"/></a></td>
						<td style="padding-left: 0.5em;">
							<div id="projectname">
								EIC Software
							</div> 
							<div id="projectbrief">
								Reference for 
								<a href="https://eic.github.io/">EIC</a> 
								<a href="https://github.com/eic/">simulation and reconstruction software on GitHub</a>
							</div> 
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Home&#160;page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../usergroup0.html"><span>External&#160;Links</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d6/d44/DenseEnvironmentExtension_8hpp_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DenseEnvironmentExtension.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/d44/DenseEnvironmentExtension_8hpp.html">Go to the documentation of this file.</a> Or view <a target="top" href="https://github.com/eic/fun4all_acts/blob/master/Core/include/Acts/Propagator/DenseEnvironmentExtension.hpp">the newest version in sPHENIX GitHub for file DenseEnvironmentExtension.hpp</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// This file is part of the Acts project.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Copyright (C) 2018-2019 CERN for the benefit of the Acts project</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This Source Code Form is subject to the terms of the Mozilla Public</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License, v. 2.0. If a copy of the MPL was not distributed with this</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// file, You can obtain one at http://mozilla.org/MPL/2.0/.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#pragma once</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/db8/GeometryContext_8hpp.html">Acts/Geometry/GeometryContext.hpp</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/da8/MagneticFieldContext_8hpp.html">Acts/MagneticField/MagneticFieldContext.hpp</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/de7/Interactions_8hpp.html">Acts/Material/Interactions.hpp</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d20/Propagator_8hpp.html">Acts/Propagator/Propagator.hpp</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d70/Core_2include_2Acts_2Utilities_2Helpers_8hpp.html">Acts/Utilities/Helpers.hpp</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">namespace </span>Acts {</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html">   26</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html" title="Evaluater of the k_i&#39;s and elements of the transport matrix D of the RKN4 stepping. This implementation involves energy loss due to ioninisation, bremsstrahlung, pair production and photonuclear interaction in the propagation and the jacobian. These effects will only occur if the propagation is in a TrackingVolume with attached material.">DenseEnvironmentExtension</a> {</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6">   28</a></span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a> = 0.;</div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28">   30</a></span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a> = 0.;</div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ad1de8e7ca0dadae1c6e34d120b20cded">   33</a></span>&#160;  <a class="code" href="../../dd/d14/classActs_1_1Material.html">Material</a> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ad1de8e7ca0dadae1c6e34d120b20cded">material</a>;</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa55bf71f0e0a9dc78675fa7a36aa8c20">   35</a></span>&#160;  std::array&lt;double, 4&gt; <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa55bf71f0e0a9dc78675fa7a36aa8c20" title="Derivatives dLambda&#39;&#39;dlambda at each sub-step point.">dLdl</a>;</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1">   37</a></span>&#160;  std::array&lt;double, 4&gt; <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a095aaa84863f34fadfa50bd4b63fb2d6">   39</a></span>&#160;  std::array&lt;double, 4&gt; <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a095aaa84863f34fadfa50bd4b63fb2d6" title="Derivatives dPds at each sub-step.">dPds</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a375f4816a809c98a27d0a0914d531590">   41</a></span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a375f4816a809c98a27d0a0914d531590" title="Derivative d(dEds)d(q/p) evaluated at the initial point.">dgdqopValue</a> = 0.;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c">   43</a></span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> = 0.;</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ae4f66a709ee2b38d5b95ed0b9f8b31ea">   45</a></span>&#160;  std::array&lt;double, 4&gt; <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ae4f66a709ee2b38d5b95ed0b9f8b31ea" title="k_i equivalent for the time propagation">tKi</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a983db6ba068b1bfe1e1d11de2c9a7334">   47</a></span>&#160;  std::array&lt;double, 4&gt; <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a983db6ba068b1bfe1e1d11de2c9a7334" title="Lambda&#39;&#39;_i.">Lambdappi</a>;</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45">   49</a></span>&#160;  std::array&lt;double, 4&gt; <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a991865f8ed510dc104ae2cedd2369de5" title="Default constructor.">DenseEnvironmentExtension</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> propagator_state_t, <span class="keyword">typename</span> stepper_t&gt;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a79c213660d154304b9dbcb850d352bfc">   61</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a79c213660d154304b9dbcb850d352bfc" title="Control function if the step evaluation would be valid.">bid</a>(<span class="keyword">const</span> propagator_state_t&amp; state, <span class="keyword">const</span> stepper_t&amp; <a class="code" href="../../dc/dd5/namespacepropagation__timing.html#a73ac659fd9b60e49ebcce460d4268319">stepper</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// Check for valid particle properties</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">if</span> (stepper.charge(state.stepping) == 0. || state.options.mass == 0. ||</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        stepper.momentum(state.stepping) &lt; state.options.momentumCutOff) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// Check existence of a volume with material</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (!state.navigation.currentVolume ||</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        !state.navigation.currentVolume-&gt;volumeMaterial()) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">return</span> 2;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> propagator_state_t, <span class="keyword">typename</span> stepper_t&gt;</div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#af3af5d06f0a066051469c6c1ad8958ce">   90</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#af3af5d06f0a066051469c6c1ad8958ce" title="Evaluater of the k_i&#39;s of the RKN4. For the case of i = 0 this step sets up member parameters...">k</a>(<span class="keyword">const</span> propagator_state_t&amp; state, <span class="keyword">const</span> stepper_t&amp; <a class="code" href="../../dc/dd5/namespacepropagation__timing.html#a73ac659fd9b60e49ebcce460d4268319">stepper</a>,</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;         <a class="code" href="../../da/d7b/namespaceActs.html#a47fe05b2c457e7bafd1853493b4c6664">Vector3D</a>&amp; knew, <span class="keyword">const</span> <a class="code" href="../../da/d7b/namespaceActs.html#a47fe05b2c457e7bafd1853493b4c6664">Vector3D</a>&amp; <a class="code" href="../../d4/d0e/namespaceActs_1_1IntegrationTest.html#a11f405cf0f6bc716502712dc3088af4e">bField</a>, std::array&lt;double, 4&gt;&amp; kQoP,</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">int</span> i = 0, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a> = 0.,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;         <span class="keyword">const</span> <a class="code" href="../../da/d7b/namespaceActs.html#a47fe05b2c457e7bafd1853493b4c6664">Vector3D</a>&amp; kprev = <a class="code" href="../../da/d7b/namespaceActs.html#a47fe05b2c457e7bafd1853493b4c6664">Vector3D</a>()) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// i = 0 is used for setup and evaluation of k</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="comment">// Set up container for energy loss</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="keyword">auto</span> volumeMaterial = state.navigation.currentVolume-&gt;volumeMaterial();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <a class="code" href="../../da/d7b/namespaceActs.html#a47fe05b2c457e7bafd1853493b4c6664">Vector3D</a> <a class="code" href="../../df/da1/namespaceActs_1_1VectorHelpers.html#ac6f67f5c5ed3c1e890b77d8dac5e4a38" title="Access to the position components of input parameter.">position</a> = stepper.position(state.stepping);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ad1de8e7ca0dadae1c6e34d120b20cded">material</a> = (volumeMaterial-&gt;material(position));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a> = stepper.momentum(state.stepping);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a> = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] = stepper.charge(state.stepping) / <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a7dc1efe4e1df4f80a0114abae4e05f24" title="Initializer of all parameters related to a RKN4 step with energy loss of a particle in material...">initializeEnergyLoss</a>(state);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="comment">// Evaluate k</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      knew = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * stepper.direction(state.stepping).cross(bField);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="comment">// Evaluate k for the time propagation</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a983db6ba068b1bfe1e1d11de2c9a7334" title="Lambda&#39;&#39;_i.">Lambdappi</a>[0] =</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          -<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[0] /</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;          (stepper.charge(state.stepping) * stepper.charge(state.stepping));</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="comment">//~ tKi[0] = std::hypot(1, state.options.mass / initialMomentum);</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ae4f66a709ee2b38d5b95ed0b9f8b31ea" title="k_i equivalent for the time propagation">tKi</a>[0] = std::hypot(1, state.options.mass * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0]);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      kQoP[0] = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a983db6ba068b1bfe1e1d11de2c9a7334" title="Lambda&#39;&#39;_i.">Lambdappi</a>[0];</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="comment">// Update parameters and check for momentum condition</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a0c4155d7240da8ae61f6a41ce590fd1d" title="Update of the kinematic parameters of the RKN4 sub-steps after initialization with energy loss of a p...">updateEnergyLoss</a>(state.options.mass, <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a>, state.stepping, stepper, i);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a> &lt; state.options.momentumCutOff) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="comment">// Evaluate k</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      knew = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[i] *</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;             (stepper.direction(state.stepping) + <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a> * kprev).<a class="code" href="../../df/da1/namespaceActs_1_1VectorHelpers.html#a6e1abd01ea4cac3276aba94096c85dae" title="Calculates column-wise cross products of a matrix and a vector and stores the result column-wise in a...">cross</a>(bField);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">// Evaluate k_i for the time propagation</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordtype">double</span> qopNew = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] + <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a983db6ba068b1bfe1e1d11de2c9a7334" title="Lambda&#39;&#39;_i.">Lambdappi</a>[i - 1];</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      Lambdappi[i] =</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;          -qopNew * qopNew * qopNew * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[i] /</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;          (stepper.charge(state.stepping) * stepper.charge(state.stepping) *</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;           <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a8aa92144917b8efb1978a93ef171cef3">UnitConstants::C</a> * <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a8aa92144917b8efb1978a93ef171cef3">UnitConstants::C</a>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ae4f66a709ee2b38d5b95ed0b9f8b31ea" title="k_i equivalent for the time propagation">tKi</a>[i] = std::hypot(1, state.options.mass * qopNew);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      kQoP[i] = Lambdappi[i];</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> propagator_state_t, <span class="keyword">typename</span> stepper_t&gt;</div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a634512bedd18df4feb03b2e3a2c1029b">  145</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a634512bedd18df4feb03b2e3a2c1029b" title="After a RKN4 step was accepted by the stepper this method has an additional veto on the quality of th...">finalize</a>(propagator_state_t&amp; state, <span class="keyword">const</span> stepper_t&amp; stepper,</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// Evaluate the new momentum</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">double</span> newMomentum =</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        stepper.momentum(state.stepping) +</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        (h / 6.) * (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a095aaa84863f34fadfa50bd4b63fb2d6" title="Derivatives dPds at each sub-step.">dPds</a>[0] + 2. * (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a095aaa84863f34fadfa50bd4b63fb2d6" title="Derivatives dPds at each sub-step.">dPds</a>[1] + <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a095aaa84863f34fadfa50bd4b63fb2d6" title="Derivatives dPds at each sub-step.">dPds</a>[2]) + <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a095aaa84863f34fadfa50bd4b63fb2d6" title="Derivatives dPds at each sub-step.">dPds</a>[3]);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// Break propagation if momentum becomes below cut-off</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (newMomentum &lt; state.options.momentumCutOff) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// Add derivative dlambda/ds = Lambda&#39;&#39;</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    state.stepping.derivative(7) =</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        -std::sqrt(state.options.mass * state.options.mass +</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                   newMomentum * newMomentum) *</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> / (newMomentum * newMomentum * newMomentum);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// Update momentum</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    state.stepping.p = newMomentum;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// Add derivative dt/ds = 1/(beta * c) = sqrt(m^2 * p^{-2} + c^{-2})</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    state.stepping.derivative(3) =</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        std::hypot(1, state.options.mass / newMomentum);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// Update time</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    state.stepping.t += (h / 6.) * (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ae4f66a709ee2b38d5b95ed0b9f8b31ea" title="k_i equivalent for the time propagation">tKi</a>[0] + 2. * (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ae4f66a709ee2b38d5b95ed0b9f8b31ea" title="k_i equivalent for the time propagation">tKi</a>[1] + <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ae4f66a709ee2b38d5b95ed0b9f8b31ea" title="k_i equivalent for the time propagation">tKi</a>[2]) + <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ae4f66a709ee2b38d5b95ed0b9f8b31ea" title="k_i equivalent for the time propagation">tKi</a>[3]);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> propagator_state_t, <span class="keyword">typename</span> stepper_t&gt;</div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a2926f556f23b86646fedd39564376039">  188</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a634512bedd18df4feb03b2e3a2c1029b" title="After a RKN4 step was accepted by the stepper this method has an additional veto on the quality of th...">finalize</a>(propagator_state_t&amp; state, <span class="keyword">const</span> stepper_t&amp; stepper,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a>, <a class="code" href="../../da/d7b/namespaceActs.html#a16c74d007bd0747c196611c857c5f40b">FreeMatrix</a>&amp; D)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a634512bedd18df4feb03b2e3a2c1029b" title="After a RKN4 step was accepted by the stepper this method has an additional veto on the quality of th...">finalize</a>(state, stepper, h) &amp;&amp; <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a298b96bbbde3c810c68199ae16463f6f" title="Evaluates the transport matrix D for the jacobian.">transportMatrix</a>(state, stepper, h, D);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> propagator_state_t, <span class="keyword">typename</span> stepper_t&gt;</div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a298b96bbbde3c810c68199ae16463f6f">  203</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a298b96bbbde3c810c68199ae16463f6f" title="Evaluates the transport matrix D for the jacobian.">transportMatrix</a>(propagator_state_t&amp; state, <span class="keyword">const</span> stepper_t&amp; stepper,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                       <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a>, <a class="code" href="../../da/d7b/namespaceActs.html#a16c74d007bd0747c196611c857c5f40b">FreeMatrix</a>&amp; D)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keyword">auto</span>&amp; sd = state.stepping.stepData;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keyword">auto</span> dir = stepper.direction(state.stepping);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    D = FreeMatrix::Identity();</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> half_h = h * 0.5;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// This sets the reference to the sub matrices</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// dFdx is already initialised as (3x3) zero</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keyword">auto</span> dFdT = D.block&lt;3, 3&gt;(0, 4);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keyword">auto</span> dFdL = D.block&lt;3, 1&gt;(0, 7);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// dGdx is already initialised as (3x3) identity</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keyword">auto</span> dGdT = D.block&lt;3, 3&gt;(4, 4);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keyword">auto</span> dGdL = D.block&lt;3, 1&gt;(4, 7);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="../../da/d7b/namespaceActs.html#ae3ffae7889547a65c59a9fe0eede1301">ActsMatrixD&lt;3, 3&gt;</a> dk1dT = <a class="code" href="../../da/d7b/namespaceActs.html#ae3ffae7889547a65c59a9fe0eede1301">ActsMatrixD&lt;3, 3&gt;::Zero</a>();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="../../da/d7b/namespaceActs.html#ae3ffae7889547a65c59a9fe0eede1301">ActsMatrixD&lt;3, 3&gt;</a> dk2dT = <a class="code" href="../../da/d7b/namespaceActs.html#ae3ffae7889547a65c59a9fe0eede1301">ActsMatrixD&lt;3, 3&gt;::Identity</a>();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="../../da/d7b/namespaceActs.html#ae3ffae7889547a65c59a9fe0eede1301">ActsMatrixD&lt;3, 3&gt;</a> dk3dT = <a class="code" href="../../da/d7b/namespaceActs.html#ae3ffae7889547a65c59a9fe0eede1301">ActsMatrixD&lt;3, 3&gt;::Identity</a>();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="../../da/d7b/namespaceActs.html#ae3ffae7889547a65c59a9fe0eede1301">ActsMatrixD&lt;3, 3&gt;</a> dk4dT = <a class="code" href="../../da/d7b/namespaceActs.html#ae3ffae7889547a65c59a9fe0eede1301">ActsMatrixD&lt;3, 3&gt;::Identity</a>();</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="../../da/d7b/namespaceActs.html#a00ba33ddaad78fdaf1aeb443a1979826">ActsVectorD&lt;3&gt;</a> dk1dL = <a class="code" href="../../da/d7b/namespaceActs.html#a00ba33ddaad78fdaf1aeb443a1979826">ActsVectorD&lt;3&gt;::Zero</a>();</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="../../da/d7b/namespaceActs.html#a00ba33ddaad78fdaf1aeb443a1979826">ActsVectorD&lt;3&gt;</a> dk2dL = <a class="code" href="../../da/d7b/namespaceActs.html#a00ba33ddaad78fdaf1aeb443a1979826">ActsVectorD&lt;3&gt;::Zero</a>();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="../../da/d7b/namespaceActs.html#a00ba33ddaad78fdaf1aeb443a1979826">ActsVectorD&lt;3&gt;</a> dk3dL = <a class="code" href="../../da/d7b/namespaceActs.html#a00ba33ddaad78fdaf1aeb443a1979826">ActsVectorD&lt;3&gt;::Zero</a>();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="../../da/d7b/namespaceActs.html#a00ba33ddaad78fdaf1aeb443a1979826">ActsVectorD&lt;3&gt;</a> dk4dL = <a class="code" href="../../da/d7b/namespaceActs.html#a00ba33ddaad78fdaf1aeb443a1979826">ActsVectorD&lt;3&gt;::Zero</a>();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    std::array&lt;double, 4&gt; jdL;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// Evaluation of the rightmost column without the last term.</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    jdL[0] = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa55bf71f0e0a9dc78675fa7a36aa8c20" title="Derivatives dLambda&#39;&#39;dlambda at each sub-step point.">dLdl</a>[0];</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    dk1dL = dir.cross(sd.B_first);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    jdL[1] = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa55bf71f0e0a9dc78675fa7a36aa8c20" title="Derivatives dLambda&#39;&#39;dlambda at each sub-step point.">dLdl</a>[1] * (1. + half_h * jdL[0]);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    dk2dL = (1. + half_h * jdL[0]) * (dir + half_h * sd.k1).cross(sd.B_middle) +</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[1] * half_h * dk1dL.cross(sd.B_middle);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    jdL[2] = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa55bf71f0e0a9dc78675fa7a36aa8c20" title="Derivatives dLambda&#39;&#39;dlambda at each sub-step point.">dLdl</a>[2] * (1. + half_h * jdL[1]);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    dk3dL = (1. + half_h * jdL[1]) * (dir + half_h * sd.k2).cross(sd.B_middle) +</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[2] * half_h * dk2dL.cross(sd.B_middle);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    jdL[3] = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa55bf71f0e0a9dc78675fa7a36aa8c20" title="Derivatives dLambda&#39;&#39;dlambda at each sub-step point.">dLdl</a>[3] * (1. + h * jdL[2]);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    dk4dL = (1. + h * jdL[2]) * (dir + h * sd.k3).cross(sd.B_last) +</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[3] * h * dk3dL.cross(sd.B_last);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    dk1dT(0, 1) = sd.B_first.z();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    dk1dT(0, 2) = -sd.B_first.y();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    dk1dT(1, 0) = -sd.B_first.z();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    dk1dT(1, 2) = sd.B_first.x();</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    dk1dT(2, 0) = sd.B_first.y();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    dk1dT(2, 1) = -sd.B_first.x();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    dk1dT *= <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0];</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    dk2dT += half_h * dk1dT;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    dk2dT = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[1] * <a class="code" href="../../df/da1/namespaceActs_1_1VectorHelpers.html#a6e1abd01ea4cac3276aba94096c85dae" title="Calculates column-wise cross products of a matrix and a vector and stores the result column-wise in a...">VectorHelpers::cross</a>(dk2dT, sd.B_middle);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    dk3dT += half_h * dk2dT;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    dk3dT = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[2] * <a class="code" href="../../df/da1/namespaceActs_1_1VectorHelpers.html#a6e1abd01ea4cac3276aba94096c85dae" title="Calculates column-wise cross products of a matrix and a vector and stores the result column-wise in a...">VectorHelpers::cross</a>(dk3dT, sd.B_middle);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    dk4dT += h * dk3dT;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    dk4dT = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[3] * <a class="code" href="../../df/da1/namespaceActs_1_1VectorHelpers.html#a6e1abd01ea4cac3276aba94096c85dae" title="Calculates column-wise cross products of a matrix and a vector and stores the result column-wise in a...">VectorHelpers::cross</a>(dk4dT, sd.B_last);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    dFdT.setIdentity();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    dFdT += h / 6. * (dk1dT + dk2dT + dk3dT);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    dFdT *= <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    dFdL = h * h / 6. * (dk1dL + dk2dL + dk3dL);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    dGdT += h / 6. * (dk1dT + 2. * (dk2dT + dk3dT) + dk4dT);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    dGdL = h / 6. * (dk1dL + 2. * (dk2dL + dk3dL) + dk4dL);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// Evaluation of the dLambda&#39;&#39;/dlambda term</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    D(7, 7) += (h / 6.) * (jdL[0] + 2. * (jdL[1] + jdL[2]) + jdL[3]);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// The following comment lines refer to the application of the time being</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// treated as a position. Since t and qop are treated independently for now,</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// this just serves as entry point for building their relation</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">//~ double dtpp1dl = -state.options.mass * state.options.mass * qop[0] *</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">//~ qop[0] *</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">//~ (3. * g + qop[0] * dgdqop(energy[0], state.options.mass,</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">//~ state.options.absPdgCode,</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">//~ state.options.meanEnergyLoss));</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">double</span> dtp1dl = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * state.options.mass * state.options.mass /</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                    std::hypot(1, <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * state.options.mass);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordtype">double</span> qopNew = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] + half_h * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a983db6ba068b1bfe1e1d11de2c9a7334" title="Lambda&#39;&#39;_i.">Lambdappi</a>[0];</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">//~ double dtpp2dl = -state.options.mass * state.options.mass * qopNew *</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">//~ qopNew *</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">//~ (3. * g * (1. + half_h * jdL[0]) +</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">//~ qopNew * dgdqop(energy[1], state.options.mass,</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">//~ state.options.absPdgCode,</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">//~ state.options.meanEnergyLoss));</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">double</span> dtp2dl = qopNew * state.options.mass * state.options.mass /</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                    std::hypot(1, qopNew * state.options.mass);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    qopNew = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] + half_h * Lambdappi[1];</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">//~ double dtpp3dl = -state.options.mass * state.options.mass * qopNew *</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">//~ qopNew *</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">//~ (3. * g * (1. + half_h * jdL[1]) +</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">//~ qopNew * dgdqop(energy[2], state.options.mass,</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">//~ state.options.absPdgCode,</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">//~ state.options.meanEnergyLoss));</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordtype">double</span> dtp3dl = qopNew * state.options.mass * state.options.mass /</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    std::hypot(1, qopNew * state.options.mass);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    qopNew = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] + half_h * Lambdappi[2];</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordtype">double</span> dtp4dl = qopNew * state.options.mass * state.options.mass /</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                    std::hypot(1, qopNew * state.options.mass);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">//~ D(3, 7) = h * state.options.mass * state.options.mass * qop[0] /</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">//~ std::hypot(1., state.options.mass * qop[0])</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">//~ + h * h / 6. * (dtpp1dl + dtpp2dl + dtpp3dl);</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    D(3, 7) = (h / 6.) * (dtp1dl + 2. * (dtp2dl + dtp3dl) + dtp4dl);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> propagator_state_t&gt;</div>
<div class="line"><a name="l00349"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a7dc1efe4e1df4f80a0114abae4e05f24">  349</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a7dc1efe4e1df4f80a0114abae4e05f24" title="Initializer of all parameters related to a RKN4 step with energy loss of a particle in material...">initializeEnergyLoss</a>(<span class="keyword">const</span> propagator_state_t&amp; state) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[0] = std::hypot(<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a>, state.options.mass);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// use unit length as thickness to compute the energy loss per unit length</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="../../de/d46/classActs_1_1MaterialProperties.html">Acts::MaterialProperties</a> slab(<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#ad1de8e7ca0dadae1c6e34d120b20cded">material</a>, 1);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// Use the same energy loss throughout the step.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (state.options.meanEnergyLoss) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> = -<a class="code" href="../../da/d7b/namespaceActs.html#a2dff236164d1fce4f839b3932d283a35">computeEnergyLossMean</a>(slab, state.options.absPdgCode,</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                 state.options.mass, <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0]);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="comment">// TODO using the unit path length is not quite right since the most</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="comment">//      probably energy loss is not independent from the path length.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> = -<a class="code" href="../../da/d7b/namespaceActs.html#a134ec0bc80f4b924e0c7911a9000d1f8">computeEnergyLossMode</a>(slab, state.options.absPdgCode,</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                                 state.options.mass, <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0]);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// Change of the momentum per path length</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// dPds = dPdE * dEds</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a095aaa84863f34fadfa50bd4b63fb2d6" title="Derivatives dPds at each sub-step.">dPds</a>[0] = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[0] / <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (state.stepping.covTransport) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="comment">// Calculate the change of the energy loss per path length and</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="comment">// inverse momentum</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">if</span> (state.options.includeGgradient) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">if</span> (state.options.meanEnergyLoss) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a375f4816a809c98a27d0a0914d531590" title="Derivative d(dEds)d(q/p) evaluated at the initial point.">dgdqopValue</a> = <a class="code" href="../../da/d7b/namespaceActs.html#ad0ba8e126708a9e4daa8613e8b73a24e">deriveEnergyLossMeanQOverP</a>(</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;              slab, state.options.absPdgCode, state.options.mass, <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0]);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;          <span class="comment">// TODO path length dependence; see above</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a375f4816a809c98a27d0a0914d531590" title="Derivative d(dEds)d(q/p) evaluated at the initial point.">dgdqopValue</a> = <a class="code" href="../../da/d7b/namespaceActs.html#aed2d0c3a3487d6b2642b867827731140">deriveEnergyLossModeQOverP</a>(</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;              slab, state.options.absPdgCode, state.options.mass, <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0]);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="comment">// Calculate term for later error propagation</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa55bf71f0e0a9dc78675fa7a36aa8c20" title="Derivatives dLambda&#39;&#39;dlambda at each sub-step point.">dLdl</a>[0] = (-<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[0] *</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                     (3. - (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a>) /</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                               (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[0])) -</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                 <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[0] * energy[0] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a375f4816a809c98a27d0a0914d531590" title="Derivative d(dEds)d(q/p) evaluated at the initial point.">dgdqopValue</a>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> stepper_state_t, <span class="keyword">typename</span> stepper_t&gt;</div>
<div class="line"><a name="l00396"></a><span class="lineno"><a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a0c4155d7240da8ae61f6a41ce590fd1d">  396</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a0c4155d7240da8ae61f6a41ce590fd1d" title="Update of the kinematic parameters of the RKN4 sub-steps after initialization with energy loss of a p...">updateEnergyLoss</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#abfc787c1e38f43984fa7e0c0db0e7b6c">mass</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a3f0102c07cb8f08075e66a7c86894182">h</a>,</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                        <span class="keyword">const</span> stepper_state_t&amp; state, <span class="keyword">const</span> stepper_t&amp; stepper,</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">int</span> i) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// Update parameters related to a changed momentum</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a> = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a60af9d8b162bc3ddbeb72a04b307ce28" title="Particles momentum at k1.">initialMomentum</a> + h * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a095aaa84863f34fadfa50bd4b63fb2d6" title="Derivatives dPds at each sub-step.">dPds</a>[i - 1];</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[i] = std::sqrt(<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a> + mass * mass);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    dPds[i] = <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[i] / <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a>;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[i] = stepper.charge(state) / <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">// Calculate term for later error propagation</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> (state.covTransport) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa55bf71f0e0a9dc78675fa7a36aa8c20" title="Derivatives dLambda&#39;&#39;dlambda at each sub-step point.">dLdl</a>[i] = (-<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[i] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[i] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a938858afddcb4788597f21019eab106c" title="Derivative dEds at the initial point.">g</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[i] *</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                     (3. - (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a> * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a70e649b411c7ae451439e25e94dedbc6" title="Momentum at a certain point.">currentMomentum</a>) /</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                               (<a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[i] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[i])) -</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                 <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[i] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[i] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#aa62cc9c6f3784fe5b736f814466172b1" title="q/p at each sub-step">qop</a>[i] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a4048ab116c269ba79cf5a574828dac45" title="Energy at each sub-step.">energy</a>[i] * <a class="code" href="../../d8/d78/structActs_1_1DenseEnvironmentExtension.html#a375f4816a809c98a27d0a0914d531590" title="Derivative d(dEds)d(q/p) evaluated at the initial point.">dgdqopValue</a>);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;};</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> action_list_t = ActionList&lt;&gt;,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;          <span class="keyword">typename</span> aborter_list_t = AbortList&lt;&gt;&gt;</div>
<div class="line"><a name="l00416"></a><span class="lineno"><a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html">  416</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html">DenseStepperPropagatorOptions</a></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    : <span class="keyword">public</span> <a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html" title="Options for propagate() call.">PropagatorOptions</a>&lt;action_list_t, aborter_list_t&gt; {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#a64db61da52638cf45d49247ee3de8491" title="Copy Constructor.">DenseStepperPropagatorOptions</a>(</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html">DenseStepperPropagatorOptions&lt;action_list_t, aborter_list_t&gt;</a>&amp;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          dspo) = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno"><a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#a74a25ad9136b63d43f0223f790aff1ff">  427</a></span>&#160;  <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#a64db61da52638cf45d49247ee3de8491" title="Copy Constructor.">DenseStepperPropagatorOptions</a>(</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      std::reference_wrapper&lt;const GeometryContext&gt; <a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a1497ab5ac41424a2f2c2b2464f797ce3">gctx</a>,</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      std::reference_wrapper&lt;const MagneticFieldContext&gt; mctx)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      : <a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html" title="Options for propagate() call.">PropagatorOptions</a>&lt;action_list_t, aborter_list_t&gt;(gctx, mctx) {}</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno"><a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#af9bfbf9ae52a1af1a0fe5df5b625b9a9">  433</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#af9bfbf9ae52a1af1a0fe5df5b625b9a9" title="Toggle between mean and mode evaluation of energy loss.">meanEnergyLoss</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno"><a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#ad9d5c8a3d2faf2d9b1b56c579f1df5f0">  436</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#ad9d5c8a3d2faf2d9b1b56c579f1df5f0" title="Boolean flag for inclusion of d(dEds)d(q/p) into energy loss.">includeGgradient</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno"><a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#a2e8a70646d8b100d5c629c11b7c360c1">  439</a></span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#a2e8a70646d8b100d5c629c11b7c360c1" title="Cut-off value for the momentum in SI units.">momentumCutOff</a> = 0.;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> extended_aborter_list_t&gt;</div>
<div class="line"><a name="l00447"></a><span class="lineno"><a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#afd4cac1e442a181d14a85b8b6a03090d">  447</a></span>&#160;  <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html">DenseStepperPropagatorOptions&lt;action_list_t, extended_aborter_list_t&gt;</a> <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#afd4cac1e442a181d14a85b8b6a03090d" title="Expand the Options with extended aborters.">extend</a>(</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      extended_aborter_list_t aborters)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html">DenseStepperPropagatorOptions&lt;action_list_t, extended_aborter_list_t&gt;</a></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        eoptions(this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a2a6e9bf1739ec812e67664cf65b84b66" title="The context object for the geometry.">geoContext</a>, this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a132faa4fc3f3f6a6e579503718a9994a" title="The context object for the magnetic field.">magFieldContext</a>);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">// Copy the options over</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#adb43a3ceb6d26414bb5a3c1c174021c6" title="Propagation direction.">direction</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#adb43a3ceb6d26414bb5a3c1c174021c6" title="Propagation direction.">direction</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a15b26ccbd4be0997cf250c599ed112dd" title="The |pdg| code for (eventual) material integration - pion default.">absPdgCode</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a15b26ccbd4be0997cf250c599ed112dd" title="The |pdg| code for (eventual) material integration - pion default.">absPdgCode</a>;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a47c3466ece9ce3fd7fb6d9ea68ce733b" title="The mass for the particle for (eventual) material integration.">mass</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a47c3466ece9ce3fd7fb6d9ea68ce733b" title="The mass for the particle for (eventual) material integration.">mass</a>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a74b68f473f50e48bb3829f774adc2845" title="Maximum number of steps for one propagate call.">maxSteps</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a74b68f473f50e48bb3829f774adc2845" title="Maximum number of steps for one propagate call.">maxSteps</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a2a3e3f10c23537cdff72503deea03e69" title="Absolute maximum step size.">maxStepSize</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a2a3e3f10c23537cdff72503deea03e69" title="Absolute maximum step size.">maxStepSize</a>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a8ac99676842c308745fe9b4b647a279b" title="Required tolerance to reach target (surface, pathlength)">targetTolerance</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a8ac99676842c308745fe9b4b647a279b" title="Required tolerance to reach target (surface, pathlength)">targetTolerance</a>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a825b4edfb9218d678439ebdb9162726a" title="Absolute maximum path length.">pathLimit</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a825b4edfb9218d678439ebdb9162726a" title="Absolute maximum path length.">pathLimit</a>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a20196372d423bef009277f536fa63c13" title="Loop protection step, it adapts the pathLimit.">loopProtection</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a20196372d423bef009277f536fa63c13" title="Loop protection step, it adapts the pathLimit.">loopProtection</a>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#aa8a7ad71e8c944fb720a7aedd90272b8" title="Allowed loop fraction, 1 is a full loop.">loopFraction</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#aa8a7ad71e8c944fb720a7aedd90272b8" title="Allowed loop fraction, 1 is a full loop.">loopFraction</a>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">// Output option</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a57ae67b40b2fa0f3f0a5d01afe9f8ba6" title="Debug output steering:">debug</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a57ae67b40b2fa0f3f0a5d01afe9f8ba6" title="Debug output steering:">debug</a>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#aca931978e3bfdf2bffea89ff17df53cc" title="the string to collect msgs">debugString</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#aca931978e3bfdf2bffea89ff17df53cc" title="the string to collect msgs">debugString</a>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a7bb76763fc45e3bc42c0da97b38b9b39" title="the prefix width">debugPfxWidth</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a7bb76763fc45e3bc42c0da97b38b9b39" title="the prefix width">debugPfxWidth</a>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a4704087ad477842af9aeef2286a51125" title="the mesage width">debugMsgWidth</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a4704087ad477842af9aeef2286a51125" title="the mesage width">debugMsgWidth</a>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">// Stepper options</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a563ca2a2c3359c73b6fed626d8ab722c" title="Tolerance for the error of the integration.">tolerance</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a563ca2a2c3359c73b6fed626d8ab722c" title="Tolerance for the error of the integration.">tolerance</a>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a13a05ec801fef7b85281dafac0d059d8" title="Cut-off value for the step size.">stepSizeCutOff</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a13a05ec801fef7b85281dafac0d059d8" title="Cut-off value for the step size.">stepSizeCutOff</a>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// Action / abort list</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a27e853592036584f27e14742c667cfe9" title="List of actions.">actionList</a> = this-&gt;<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a27e853592036584f27e14742c667cfe9" title="List of actions.">actionList</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    eoptions.<a class="code" href="../../d6/d89/structActs_1_1PropagatorOptions.html#a31615ff4dcd1c707e51d884272f64a70" title="List of abort conditions.">abortList</a> = std::move(aborters);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// Copy dense environment specific parameters</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    eoptions.<a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#af9bfbf9ae52a1af1a0fe5df5b625b9a9" title="Toggle between mean and mode evaluation of energy loss.">meanEnergyLoss</a> = <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#af9bfbf9ae52a1af1a0fe5df5b625b9a9" title="Toggle between mean and mode evaluation of energy loss.">meanEnergyLoss</a>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    eoptions.<a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#ad9d5c8a3d2faf2d9b1b56c579f1df5f0" title="Boolean flag for inclusion of d(dEds)d(q/p) into energy loss.">includeGgradient</a> = <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#ad9d5c8a3d2faf2d9b1b56c579f1df5f0" title="Boolean flag for inclusion of d(dEds)d(q/p) into energy loss.">includeGgradient</a>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    eoptions.<a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#a2e8a70646d8b100d5c629c11b7c360c1" title="Cut-off value for the momentum in SI units.">momentumCutOff</a> = <a class="code" href="../../d6/dc3/structActs_1_1DenseStepperPropagatorOptions.html#a2e8a70646d8b100d5c629c11b7c360c1" title="Cut-off value for the momentum in SI units.">momentumCutOff</a>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">// And return the options</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span> eoptions;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;};</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;}  <span class="comment">// namespace Acts</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->

<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="navelem"><a class="el" href="../../dir_1ecc4290ca7a8ab7e710692e3f5c1b51.html">fun4all_acts</a></li><li class="navelem"><a class="el" href="../../dir_4dc0fd927546a3a68ed89698e8f23f2e.html">blob</a></li><li class="navelem"><a class="el" href="../../dir_4512773754372b6221cc507d9c0893df.html">master</a></li><li class="navelem"><a class="el" href="../../dir_edb9e86a382853b528ab6d291cec6611.html">Core</a></li><li class="navelem"><a class="el" href="../../dir_9ed89187f1f0b3b0de522bfdb3dd0030.html">include</a></li><li class="navelem"><a class="el" href="../../dir_3fa139eedd14f2f46bdb8a1272d0e0aa.html">Acts</a></li><li class="navelem"><a class="el" href="../../dir_554e322104dada6247b78369dcbdaa98.html">Propagator</a></li><li class="navelem"><a class="el" href="../../d6/d44/DenseEnvironmentExtension_8hpp.html">DenseEnvironmentExtension.hpp</a></li>
		<li class="footer">
		Built by <a href="mailto:jhuang@bnl.gov">Jin Huang</a></em>.
			updated: <em>Fri Jun 5 2020 18:43:10</em> using <a
			href="http://www.doxygen.org/index.html"> <img class="footer"
				src="../../doxygen.png" alt="doxygen" /></a> 1.8.2 
				with <a href="https://github.com/eic">EIC GitHub integration</a>
		</li>
	</ul>
</div>
</body>
</html>
