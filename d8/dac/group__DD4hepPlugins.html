<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<title>EIC Software: DD4hepPlugins</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script> <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script> 
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155388685-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-155388685-3');
</script>
</head>
<body>
	<div id="top">
		<!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectlogo"><a href="https://eic.github.io/"><img
								alt="Logo" src="../../ion-collision-xparent-crop.png" height="100"/></a></td>
						<td style="padding-left: 0.5em;">
							<div id="projectname">
								EIC Software
							</div> 
							<div id="projectbrief">
								Reference for 
								<a href="https://eic.github.io/">EIC</a> 
								<a href="https://github.com/eic/">simulation and reconstruction software on GitHub</a>
							</div> 
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Home&#160;page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../usergroup0.html"><span>External&#160;Links</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d8/dac/group__DD4hepPlugins.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DD4hepPlugins</div>  </div>
<div class="ingroups"><a class="el" href="../../dd/dd3/group__Plugins.html">Plugins</a></div></div><!--header-->
<div class="contents">

<p>Build <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a> tracking geometry from <em>DD4hep</em> input.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for DD4hepPlugins:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><div class="center"><iframe scrolling="no" frameborder="0" src="../../d8/dac/group__DD4hepPlugins.svg" width="255" height="39"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</td></tr></table></center>
</div>
<p>Build <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a> tracking geometry from <em>DD4hep</em> input. </p>
<p>The DD4hepPlugin allows building of the <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a> TrackingGeometry from <a href="http://aidasoft.web.cern.ch/DD4hep">DD4hep</a> input. <em>DD4hep</em> uses <a href="https://root.cern.ch">ROOT</a> TGeo as an underlying geometry model.</p>
<p><b>General</b></p>
<p>The basic input for building the detector are a detector description in the XML file format and a corresponding detector constructor written in C++. These two components have to be changed accordingly. <a class="el" href="../../da/daf/namespaceDetector.html">Detector</a> constructors use these XML files as an input and construct a detector in the <em>DD4hep</em> geometry format. The whole detector is segmented into different detector parts, e.g. barrels and endcaps which describe different sub-detectors. Since these sub-detectors are built differently, they need different detector constructors. In this way one detector description in XML can use various detector constructors, needed for the different kinds of detector parts.</p>
<p>In the detector description model of <em>DD4hep</em> any detector is a tree of instances of the so-called <em>DetElement</em> class. This <em>DetElement</em> class provides all needed detector information, e.g. readout segmentation, geometrical information, environmental conditions. This tree is parallel to the volume tree, which provides the TGeoVolumes and their placements. The relation between these two trees is one-directional, i.e. every volume can be accessed via its corresponding <em>DetElement</em>, but not vice versa. Not every supporting material will be declared as a detector element, hence, the geometrical tree can have a deeper hierarchy structure. In order to access both, detector specific and geometrical information, the conversion to the tracking geometry navigates through the detector tree. The <em>DetElement</em> can also be extended, to add specific features or to access information. This extension mechanism is used during the translation process.</p>
<p><b>ActsExtensions</b></p>
<p><em>DD4hep</em> provides a special extension mechanism for the <em>DetElement</em> which allows to add custom features. In <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a> this functionality is used for the conversion from <em>DD4hep</em> into <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a>. The extensions are used to indicate certain volumes, e.g. if a <em>DetElement</em> is the beam pipe or if a <em>DetElement</em> is a layer carrying the sensitive modules. In addition the extensions are used in order to distinguish if a sub detector is a barrel (described as a cylinder volume in <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a>) or an endcap (which is described as a disc volume in <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a>). Furthermore the extensions are used to hand over specific information needed for tracking, e.g. paramters for material mapping. Please find further information in <a class="el" href="../../d8/d8a/classActs_1_1ActsExtension.html" title="Extension of the DD4hep DetElement needed for translation into the Acts tracking geometry.">Acts::ActsExtension</a>.</p>
<p><b>DD4hepDetectorElement</b></p>
<p>In <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a> the surfaces describing the sensitive modules of a detector are directly linked to these of the initial geometry input. In the case of <em>DD4hep</em> the <a class="el" href="../../d5/ded/classActs_1_1DD4hepDetectorElement.html" title="DetectorElement class implementation for DD4hep geometry.">Acts::DD4hepDetectorElement</a> was introduced which is the direct link of <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a> to <em>DD4hep</em>. In the case for tracking relevant paramters in the <em>DD4hep</em> geometry description are changed (e.g. alignment) it will be automatically changed in <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a>.</p>
<p><b>Build</b></p>
<p>The DD4hepPlugin is only build on demand. The DD4hepPlugin depends on the TGeoPlugin therefore both Plugins need to be installed. During the cmake configuration the flags <code>ACTS_BUILD_DD4HEP_PLUGIN</code> and <code>ACTS_BUILD_TGEO_PLUGIN</code> need to be set <em>ON</em>. In addition <em>ROOT</em> and <em>DD4hep</em> need to be added to the <code>CMAKE_PREFIX_PATH</code>. When using the DD4hepPlugin both the TGeoPlugin and the DD4hepPlugin components need to be loaded in the user's CMake configuration.</p>
<p><b>Prerequisites</b></p>
<p>To guarantee a working translation from <em>DD4hep</em> input to <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a> geometry the following conditions need to be met:</p>
<ul>
<li>The detector needs to have a barrel-endcap structure: Every hierarchy of subdetectors (e.g. PixelDetector, StripDetector,..) needs to be decomposed of 1) {barrel} 2) {barrel + 2 endcaps} 3) {2 endcaps} - in case there is no barrel at this stage (e.g. forward end caps)</li>
</ul>
<ul>
<li><p class="startli">If a hierachy is not only a single barrel but is decomposed of a barrel and its corresponding endcaps they need to be grouped together in an assembly using the <code>DD4hep_SubdetectorAssembly</code> constructor which is provided by <em>DD4hep</em>. Example of usage in xml file (where <code>Barrel0</code>, <code>nEndCap0</code> and <code>pEndCap0</code> are sub detectors defined in the file <code>PixelTracker.xml</code>): </p>
<div class="fragment"><div class="line">&lt;include ref=<span class="stringliteral">&quot;PixelTracker.xml&quot;</span>/&gt;</div>
<div class="line">&lt;detectors&gt;</div>
<div class="line">  &lt;detector <span class="keywordtype">id</span>=<span class="stringliteral">&quot;1&quot;</span> <a class="code" href="../../d3/d16/VstRadLength_8C.html#a5ac083a645d964373f022d03df4849c8">name</a>=<span class="stringliteral">&quot;PixelTracker&quot;</span> type=<span class="stringliteral">&quot;DD4hep_SubdetectorAssembly&quot;</span></div>
<div class="line">   vis=<span class="stringliteral">&quot;BlueVisTrans&quot;</span>&gt;</div>
<div class="line">    &lt;shape <a class="code" href="../../d3/d16/VstRadLength_8C.html#a5ac083a645d964373f022d03df4849c8">name</a>=<span class="stringliteral">&quot;PixelEnvelope&quot;</span> type=<span class="stringliteral">&quot;Tube&quot;</span> rmin=<span class="stringliteral">&quot;Env0_rmin&quot;</span></div>
<div class="line">     rmax=<span class="stringliteral">&quot;Env0_rmax&quot;</span> <a class="code" href="../../d7/d5a/namespaceG4HCALIN.html#a62a3eb7110b8884ca230d2f86f5f635b">dz</a>=<span class="stringliteral">&quot;Env0_dz&quot;</span> <a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#a7656fffb12b327106317bced24bb967a">material</a>=<span class="stringliteral">&quot;Air&quot;</span>/&gt;</div>
<div class="line">      &lt;composite name=<span class="stringliteral">&quot;Barrel0&quot;</span>/&gt;</div>
<div class="line">      &lt;composite name=<span class="stringliteral">&quot;nEndCap0&quot;</span>/&gt;</div>
<div class="line">      &lt;composite name=<span class="stringliteral">&quot;pEndCap0&quot;</span>/&gt;</div>
<div class="line">  &lt;/detector&gt;</div>
<div class="line">&lt;/detectors&gt;</div>
</div><!-- fragment --><p class="startli">If a user wants to create his/her own constructor to group these volumes together the type needs to be set to "compound".</p>
</li>
</ul>
<ul>
<li>Since the translation walks trough the <em>DetElement</em> tree the following objects need to be declared as a <em>DD4hep</em> <em>DetElement:</em> <ul>
<li>the subvolumes e.g. <b>barrel</b>, <b>endcap</b>, <b>beampipe</b> (they are usually build with different <em>DD4hep</em> constructors and are therefore <em>DD4hep</em> <em>DetElement's</em> per default)</li>
<li><b>layers</b> when containing sensitive material and/or the layer should carry material (which will be mapped on the layer if indicated), or the layer is sensitive itself <dl class="section note"><dt>Note</dt><dd>the layer does not need to be a direct child of the volume (barrel or endcap), it can be nested in substructures</dd></dl>
<ul>
<li>sensitive detector modules <dl class="section note"><dt>Note</dt><dd>the sensitive detector modules need to be placed in a layer however it can be nested in substructures (can be a component of a modules) i.e. it does not need to be a direct child of the layer</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
<li>The Tracking geometry needs to be built from bottom to top to ensure navigation. Therefore the different hierachies need to be sorted ascending. Per default the sub detectors are sorted by the id of their dd4hep::DetElement. In case another sorting needs to be applied, the users can provide their own function</li>
</ul>
<ul>
<li>The <a class="el" href="../../d8/d8a/classActs_1_1ActsExtension.html" title="Extension of the DD4hep DetElement needed for translation into the Acts tracking geometry.">Acts::ActsExtension</a>'s need to be used during the detector construction indicating if a <em>DetElement</em> <ul>
<li>is a barrel</li>
<li>is an endcap</li>
<li>is the beampipe</li>
<li>is a layer</li>
</ul>
</li>
</ul>
<p>There are two modes building the layers around the sensitive detector modules:</p>
<ul>
<li>The <em>DetElements</em> containing the sensitive modules have a geometrical shape<ul>
<li>the boundaries of the layers in <a class="el" href="../../da/d7b/namespaceActs.html" title="Set the Geometry Context PLUGIN.">Acts</a> are taken directly from the given shape</li>
</ul>
</li>
<li>The <em>DetElements</em> containing the sensitive modules have no specific shape (assembliy)<ul>
<li>the boundaries of the layers are calculated automatically by adding a tolerance to the geometric extension of the contained surfaces</li>
<li>the tolerances in r and z need to be set for every <em>DetElement</em> representing layer using envelopeR and envelopeZ in the <a class="el" href="../../d8/d8a/classActs_1_1ActsExtension.html" title="Extension of the DD4hep DetElement needed for translation into the Acts tracking geometry.">Acts::ActsExtension</a>'s</li>
</ul>
</li>
</ul>
<p>The volumes are automatically build around the layers:</p>
<ul>
<li>the boundaries for the volumes are calculated automatically by adding a tolerance to the geometric extension of the contained layers</li>
<li>the parameters layerEnvelopeR and layerEnvelopeZ (tolerances) need to be set in the <a class="el" href="../../da/d7b/namespaceActs.html#a0c63e76f7630861ac540912461f8864b" title="Global method which creates the TrackingGeometry from DD4hep input.">Acts::convertDD4hepDetector()</a> function</li>
</ul>
<p>Furthermore parameters can be handed over for material mapping or the axes orientation of modules.</p>
<p>Summing up the <em>DetElement</em> tree in <em>DD4hep</em> should have the following structure: </p>
<div class="image">
<img src="../../DD4hepPlugin_DetElementStructure.jpg" alt="DD4hepPlugin_DetElementStructure.jpg"/>
</div>
<p>It is also possible to translate a very simple detector geometry, which just consists of cylindrical (for a barrel) or disc (for endcaps) layers which either have material, or, are declared sensitive in <a class="el" href="../../d3/d0b/namespacedd4hep.html">dd4hep</a> themselves without containing any detector modules.</p>
<p><b>Usage</b></p>
<p>To receive the <a class="el" href="../../db/da9/classActs_1_1TrackingGeometry.html">Acts::TrackingGeometry</a> the user should use the global function <a class="el" href="../../da/d7b/namespaceActs.html#a0c63e76f7630861ac540912461f8864b" title="Global method which creates the TrackingGeometry from DD4hep input.">Acts::convertDD4hepDetector()</a>, where he/she needs to hand over the world <em>DetElement</em> of <em>DD4hep</em>. For a valid translation the user needs to make sure, that all prerequisites described above are met and that the right <a class="el" href="../../d8/d8a/classActs_1_1ActsExtension.html" title="Extension of the DD4hep DetElement needed for translation into the Acts tracking geometry.">Acts::ActsExtension</a>'s are added during the <em>DD4hep</em> construction. </p>
</div><!-- contents -->
</div><!-- doc-content -->

<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="footer">
		Built by <a href="mailto:jhuang@bnl.gov">Jin Huang</a></em>.
			updated: <em>Fri Jun 5 2020 18:43:43</em> using <a
			href="http://www.doxygen.org/index.html"> <img class="footer"
				src="../../doxygen.png" alt="doxygen" /></a> 1.8.2 
				with <a href="https://github.com/eic">EIC GitHub integration</a>
		</li>
	</ul>
</div>
</body>
</html>
